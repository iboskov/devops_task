# Architecture Diagram

Use this as a reference to create a visual diagram (draw.io, Lucidchart, etc.)

## System Architecture

```
┌─────────────────────────────────────────────────────────────────────────────────────┐
│                                    AZURE CLOUD                                       │
│                                                                                      │
│  ┌────────────────────────────────────────────────────────────────────────────────┐ │
│  │                           Resource Group: demo-rg                               │ │
│  │                                                                                 │ │
│  │  ┌──────────────────────────────────────────────────────────────────────────┐  │ │
│  │  │                        VNet: 10.0.0.0/16                                  │  │ │
│  │  │                                                                           │  │ │
│  │  │  ┌─────────────────────┐        ┌─────────────────────────────────────┐  │  │ │
│  │  │  │  Public Subnet      │        │     Private Subnet                   │  │  │ │
│  │  │  │  10.0.1.0/24        │        │     10.0.2.0/24                      │  │  │ │
│  │  │  │                     │        │                                      │  │  │ │
│  │  │  │  ┌───────────────┐  │        │  ┌────────────────────────────────┐  │  │  │ │
│  │  │  │  │ Load Balancer │◄─┼────────┼──│      AKS Node Pool             │  │  │  │ │
│  │  │  │  │ (Frontend)    │  │        │  │                                │  │  │  │ │
│  │  │  │  └───────────────┘  │        │  │  ┌──────────┐  ┌──────────┐   │  │  │  │ │
│  │  │  │                     │        │  │  │  Node 1  │  │  Node 2  │   │  │  │  │ │
│  │  │  │  NSG: Allow 80/443  │        │  │  └──────────┘  └──────────┘   │  │  │  │ │
│  │  │  └─────────────────────┘        │  │                                │  │  │  │ │
│  │  │                                 │  │  NSG: Allow VNet, Deny Internet│  │  │  │ │
│  │  │                                 │  └────────────────────────────────┘  │  │  │ │
│  │  │                                 │              │                       │  │  │ │
│  │  │                                 │              ▼                       │  │  │ │
│  │  │                                 │  ┌─────────────────┐                 │  │  │ │
│  │  │                                 │  │   NAT Gateway   │──► Internet    │  │  │ │
│  │  │                                 │  │   (Outbound)    │   (Pull images)│  │  │ │
│  │  │                                 │  └─────────────────┘                 │  │  │ │
│  │  │                                 └─────────────────────────────────────┘  │  │ │
│  │  └──────────────────────────────────────────────────────────────────────────┘  │ │
│  │                                                                                 │ │
│  │  ┌─────────────────────┐                                                        │ │
│  │  │  Azure Container    │◄─── AKS pulls images (Managed Identity + AcrPull)     │ │
│  │  │  Registry (ACR)     │                                                        │ │
│  │  └─────────────────────┘                                                        │ │
│  │           ▲                                                                     │ │
│  └───────────┼─────────────────────────────────────────────────────────────────────┘ │
│              │                                                                       │
└──────────────┼───────────────────────────────────────────────────────────────────────┘
               │
               │ Push Image
               │
┌──────────────┴───────────────────────────────────────────────────────────────────────┐
│                              CI/CD PIPELINE                                          │
│                                                                                      │
│  ┌─────────────┐      ┌─────────────────┐      ┌─────────────┐      ┌────────────┐  │
│  │   GitHub    │──────│  GitHub Actions │──────│    Build    │──────│   Push to  │  │
│  │   (Code)    │ Push │   (Workflow)    │      │   Docker    │      │    ACR     │  │
│  └─────────────┘      └─────────────────┘      └─────────────┘      └────────────┘  │
│         │                                                                   │        │
│         │                                                                   │        │
│         ▼                                                                   ▼        │
│  ┌─────────────┐                                              ┌─────────────────┐   │
│  │ Helm Chart  │◄─────────────────────────────────────────────│ Update values   │   │
│  │ (Git Repo)  │                                              │ (new image tag) │   │
│  └─────────────┘                                              └─────────────────┘   │
│         │                                                                            │
│         │ Sync (Auto)                                                                │
│         ▼                                                                            │
│  ┌─────────────────────────────────────────────────────────────────────────────┐    │
│  │                              ArgoCD (in AKS)                                 │    │
│  │                                                                              │    │
│  │   Watches Git repo ──► Detects changes ──► Applies to Kubernetes            │    │
│  └─────────────────────────────────────────────────────────────────────────────┘    │
│                                                                                      │
└──────────────────────────────────────────────────────────────────────────────────────┘
```

## Kubernetes Application Architecture

```
┌────────────────────────────────────────────────────────────────────────────────┐
│                            AKS Cluster                                          │
│                                                                                 │
│  ┌─────────────────────────────────────────────────────────────────────────┐   │
│  │                        Namespace: argocd                                 │   │
│  │  ┌──────────────────┐  ┌──────────────────┐  ┌────────────────────┐     │   │
│  │  │  argocd-server   │  │  argocd-repo-srv │  │  argocd-controller │     │   │
│  │  │  (UI + API)      │  │  (Git sync)      │  │  (Reconciliation)  │     │   │
│  │  └──────────────────┘  └──────────────────┘  └────────────────────┘     │   │
│  └─────────────────────────────────────────────────────────────────────────┘   │
│                                                                                 │
│  ┌─────────────────────────────────────────────────────────────────────────┐   │
│  │                        Namespace: demo-app                               │   │
│  │                                                                          │   │
│  │    ┌─────────────────────────────────────────────────────────────────┐  │   │
│  │    │                    Frontend (Nginx)                              │  │   │
│  │    │                                                                  │  │   │
│  │    │  ┌─────────────┐    ┌─────────────┐                             │  │   │
│  │    │  │   Pod       │    │   Pod       │    Replicas: 2              │  │   │
│  │    │  │  (nginx)    │    │  (nginx)    │                             │  │   │
│  │    │  └─────────────┘    └─────────────┘                             │  │   │
│  │    │         │                  │                                     │  │   │
│  │    │         └────────┬─────────┘                                     │  │   │
│  │    │                  ▼                                               │  │   │
│  │    │         ┌─────────────────┐                                      │  │   │
│  │    │         │ Service: LB     │◄──── External Traffic (Port 80)     │  │   │
│  │    │         │ (LoadBalancer)  │                                      │  │   │
│  │    │         └─────────────────┘                                      │  │   │
│  │    └─────────────────────────────────────────────────────────────────┘  │   │
│  │                                                                          │   │
│  │    ┌─────────────────────────────────────────────────────────────────┐  │   │
│  │    │                    Backend (Redis)                               │  │   │
│  │    │                                                                  │  │   │
│  │    │  ┌─────────────┐                                                │  │   │
│  │    │  │   Pod       │    Replicas: 1                                 │  │   │
│  │    │  │  (redis)    │                                                │  │   │
│  │    │  └─────────────┘                                                │  │   │
│  │    │         │                                                        │  │   │
│  │    │         ▼                                                        │  │   │
│  │    │  ┌─────────────────┐                                            │  │   │
│  │    │  │ Service: CIP    │◄──── Internal Traffic Only (Port 6379)    │  │   │
│  │    │  │ (ClusterIP)     │                                            │  │   │
│  │    │  └─────────────────┘                                            │  │   │
│  │    └─────────────────────────────────────────────────────────────────┘  │   │
│  └─────────────────────────────────────────────────────────────────────────┘   │
│                                                                                 │
└────────────────────────────────────────────────────────────────────────────────┘
```

## Data Flow

```
User Request Flow:
──────────────────
Internet ──► Azure Load Balancer ──► Frontend Service ──► Nginx Pod ──► Redis Service ──► Redis Pod

Deployment Flow:
────────────────
Developer ──► Git Push ──► GitHub Actions ──► Build Image ──► Push ACR ──► Update Helm Values
                                                                                    │
ArgoCD ◄───────────── Detect Change ◄───────────── Git Repo ◄──────────────────────┘
   │
   └──► Apply Manifests ──► Kubernetes ──► Rolling Update ──► New Pods
```

## Network Security

```
┌─────────────────────────────────────────────────────────────────┐
│                    Network Security Groups                       │
│                                                                  │
│  Public Subnet NSG:                                              │
│  ┌────────────────────────────────────────────────────────────┐ │
│  │  ALLOW: TCP 80  (HTTP)   - Source: Internet                │ │
│  │  ALLOW: TCP 443 (HTTPS)  - Source: Internet                │ │
│  │  DENY:  *                - Source: Internet (implicit)     │ │
│  └────────────────────────────────────────────────────────────┘ │
│                                                                  │
│  Private Subnet NSG:                                             │
│  ┌────────────────────────────────────────────────────────────┐ │
│  │  ALLOW: *     - Source: VirtualNetwork                     │ │
│  │  DENY:  *     - Source: Internet                           │ │
│  └────────────────────────────────────────────────────────────┘ │
│                                                                  │
└─────────────────────────────────────────────────────────────────┘
```

---

**To create a visual diagram:**

1. Use [draw.io](https://draw.io) (free)
2. Use [Lucidchart](https://lucidchart.com)
3. Use [Excalidraw](https://excalidraw.com) (free, hand-drawn style)
4. Use Azure Architecture icons: [Download](https://docs.microsoft.com/en-us/azure/architecture/icons/)

Export as PNG and save to `/docs/architecture.png`
